{% extends "base.html" %}

{% block content %}

    <div class="profile">

    {% if not user.is_verified %}
        <div class="profile-notification">
            Ваш аккаунт не подтвержден! Лично покажите свой паспорт администратору бара для верификации
        </div>
    {% endif %}

        <div class="up-profile">
            <div class="account-card">
                <p class="account-name"> {{user.user_name}} <br>{{user.user_surname}}</p>
                <p class="account-p">{{user.phone}}</p>
                <p class="account-email">{{user.email}}</p>
                <a class="confirm-button" href="/logout">Выйти</a>
            </div>

            <div class="left-up-profile">
                <p class="page_title white_text">Заказы</p>
                
                <div class="orders-profile" id="orders-profile">
                    {% for order in table_orders %}
                        
                        <div class="order-card">
                            <div class="order-up-detail">
                                <div class="order-left">
                                    <p class="order-status"> {% if order.order.o_status == 'выполнен' %}Готов{% elif order.order.o_status == 'готовится' %}Готовится{% else %}Оформлен{% endif %}</p>
                                    <p class="order-details">{{order.table}}</p>
                                </div>
                                <div class="order-ri">
                                    <p class="order-number">№{{"%03d"|format(order.order.o_id)}}</p>
                                    <button class="details-button" onclick="toggleDetails('{{ order.order.o_id }}')" >Подробности</button>
                                </div>
                            </div>

                            <div class="order-detail" id="details-{{ order.order.o_id }}" style="display: none;">
                                <p class="specials_card_title his_titl">Продукты: {{ order.product_info }}</p>
                                <p class="specials_card_title his_titl">Сумма заказа: {{ order.order.o_sum }}р.</p>
                            </div>
                        </div>

                        
                    {% endfor %}

                </div>
             </div>

        </div>

        <p class="page_title white_text">История заказов</p>

        <div class="history">
            <div class="history-card" id="historyCards">
                {% for order in orders_data %}
                <div class="specials_card anim">
                    <div class="specials_card_content">
                        <div class="specials_card_image">
                            <img src="{{order.random_product.img_prod}}" alt="{{order.prod_name}}" />
                        </div>
                        <div class="specials_card_info">
                            <p class="specials_card_title his_title">{{order.product_info}}</p>
                            <p class="specials_card_price his_price">{{order.o_sum}}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}

                
            </div>
            <div class="history_see_all" onclick="viewHistory()">
                Смотреть всю историю
                <div class="history_see_all_arrow">
                    <img src="{{ url_for('static', filename='image/small-arrow-right.svg') }}" alt="Стрелка вправо" />
                </div>
            </div>
        </div>


<script>
    const carousel = document.getElementById('orders-profile');
    let isScrolling;

    const scrollCarousel = (delta) => {
        const scrollAmount = delta * 4; 
        carousel.scrollBy({
            left: scrollAmount,
            behavior: 'smooth'
        });
    };

    carousel.addEventListener('wheel', (event) => {
        event.preventDefault();
    
        const delta = event.deltaY || -event.deltaX;

        if ((carousel.scrollLeft === 0 && delta < 0) || 
            (carousel.scrollLeft + carousel.clientWidth >= carousel.scrollWidth && delta > 0)) {
            return; 
        }

        cancelAnimationFrame(isScrolling);
        isScrolling = requestAnimationFrame(() => scrollCarousel(delta));
    });


    function toggleDetails(orderId) {
        var detailsDiv = document.getElementById('details-' + orderId);
        if (detailsDiv.style.display === 'none') {
            detailsDiv.style.display = 'block'; // Показываем детали
        } else {
            detailsDiv.style.display = 'none'; // Скрываем детали
        }
    }


    let allCardsVisible = false;

    function viewHistory() {
        const historyCards = document.getElementById('historyCards');
        const specialsCards = Array.from(historyCards.children);
        
        if (!allCardsVisible) {
            specialsCards.forEach(card => {
                card.classList.remove('hid'); 
            });
            allCardsVisible = true; 
        } else {
           
            specialsCards.forEach((card, index) => {
                if (index >= 3) {
                    card.classList.add('hid'); 
                }
            });
            allCardsVisible = false; 
        }
    }

    function initHistoryCards() {
        const orders = document.getElementById('orders-profile');
        const orderCards = Array.from(orders.children);
        const totalCards = orderCards.length;

        orderCards.forEach((card, index) => {
            if (index > 1) {
                card.classList.add('hidden'); 
            }
        });

        const historyCards = document.getElementById('historyCards');
        const specialsCards = Array.from(historyCards.children);
        
        specialsCards.forEach((card, index) => {
            if (index >= 3) {
                card.classList.add('hid'); 
            }
        });
    }

    window.onload = initHistoryCards;


</script>


{% endblock %}