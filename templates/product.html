{% extends "base.html" %}

{% block content %}

<div class="product_container">
    <div class="product_page_image">
        <img src="{{ product.img_prod }}" alt="{{ product.prod_name }}">
    </div>
    <div class="product_page_info">
        <p class="product_page_title">{{ product.prod_name }}</p>
        <div class="product_page_description">
            Состав:
            <ul>
                {% for item in description_list %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>
        <p class="product_page_price">{{ product.price }} P</p>
        <div class="product_page_buttons">
            <div class="product_page_button_order">
                Заказать сейчас
            </div>
            <div class="product_page_button_card">
                В корзину
            </div>
        </div>
    </div>
</div>

<div class="reviews_container">

    <div class="reviews_title_container">
        <div class="reviews_title">
            Отзывы
        </div>

        <div class="make_new_review" id="openModal">
            Написать отзыв
        </div>

    </div>

    <div class="reviews_cards_container">
        {% for review in reviews %}
            <div class="reviews_card">
                <div class="reviews_username">
                    {{ review.user.user_name }} {{ review.user.user_surname }}
                </div>
                <div class="reviews_content">
                    {{ review.comment }}
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="no-reviews-message" style="display: {% if reviews|length == 0 %}block{% else %}none{% endif %};">
        Пока что здесь нет отзывов
    </div>

    <div class="reviews_see_all">
        Смотреть все отзывы
        <div class="reviews_see_all_arrow">
            <img src="{{ url_for('static', filename='image/small-arrow-right.svg') }}" alt="Стрелка вправо" />
        </div>
    </div>

</div>


<div class="try_also_container">
    <div class="try_also_title">
        Попробуйте так же
    </div>
    <div class="try_also_cards">
            {% for product in products %}
            <div class="catalog_card">
                <a href="{{ url_for('product', id=product.prod_id) }}">
                    <div class="catalog_card_content">

                        <div class="catalog_card_image">
                            <img src="{{ product.img_prod }}" alt="{{ product.prod_name }}" />
                        </div>

                        <div class="catalog_card_info">
                            <p class="catalog_card_price">{{ product.price }} P</p>
                            <p class="catalog_card_title">{{ product.prod_name }}</p>
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
    </div>
</div>

<div id="reviewModal" class="modal">
    <div class="modal-content">
        <div class ="reviewModal_title" >Написать отзыв</div>
        <form method="POST" action="">
            {{ form.hidden_tag() }}
            {{ form.comment(size=32, placeholder="Ваш отзыв", class="reviewModal_field") }}
            {{ form.submit(class="reviewModal_button") }}
        </form>
    </div>
</div>

<script>
    const carousel = document.querySelector('.try_also_cards');
    let isScrolling;
    

    const scrollCarousel = (delta) => {
        const scrollAmount = delta * 4; 
        carousel.scrollBy({
            left: scrollAmount,
            behavior: 'smooth'
        });
    };
    
    carousel.addEventListener('wheel', (event) => {
        event.preventDefault();
        
        const delta = event.deltaY || -event.deltaX;
    
    
        if ((carousel.scrollLeft === 0 && delta < 0) || 
            (carousel.scrollLeft + carousel.clientWidth >= carousel.scrollWidth && delta > 0)) {
            return; 
        }
    
        cancelAnimationFrame(isScrolling);
        isScrolling = requestAnimationFrame(() => scrollCarousel(delta));
    });

    const modal = document.getElementById('reviewModal');
    const openModalButton = document.getElementById('openModal');


    openModalButton.onclick = function() {
        modal.style.display = 'block';
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none'; 
        }
    }
    
</script>
{% endblock %}